# æ­£åˆ™çš„æ‰©å±•

1. [RegExp æ„é€ å‡½æ•°](https://es6.ruanyifeng.com/#docs/regex#RegExp%20%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0)
2. [å­—ç¬¦ä¸²çš„æ­£åˆ™æ–¹æ³•](https://es6.ruanyifeng.com/#docs/regex#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%AD%A3%E5%88%99%E6%96%B9%E6%B3%95)
3. [u ä¿®é¥°ç¬¦](https://es6.ruanyifeng.com/#docs/regex#u%20%E4%BF%AE%E9%A5%B0%E7%AC%A6)
4. [RegExp.prototype.unicode å±æ€§](https://es6.ruanyifeng.com/#docs/regex#RegExp.prototype.unicode%20%E5%B1%9E%E6%80%A7)
5. [y ä¿®é¥°ç¬¦](https://es6.ruanyifeng.com/#docs/regex#y%20%E4%BF%AE%E9%A5%B0%E7%AC%A6)
6. [RegExp.prototype.sticky å±æ€§](https://es6.ruanyifeng.com/#docs/regex#RegExp.prototype.sticky%20%E5%B1%9E%E6%80%A7)
7. [RegExp.prototype.flags å±æ€§](https://es6.ruanyifeng.com/#docs/regex#RegExp.prototype.flags%20%E5%B1%9E%E6%80%A7)
8. [s ä¿®é¥°ç¬¦ï¼šdotAll æ¨¡å¼](https://es6.ruanyifeng.com/#docs/regex#s%20%E4%BF%AE%E9%A5%B0%E7%AC%A6%EF%BC%9AdotAll%20%E6%A8%A1%E5%BC%8F)
9. [åè¡Œæ–­è¨€](https://es6.ruanyifeng.com/#docs/regex#%E5%90%8E%E8%A1%8C%E6%96%AD%E8%A8%80)
10. [Unicode å±æ€§ç±»](https://es6.ruanyifeng.com/#docs/regex#Unicode%20%E5%B1%9E%E6%80%A7%E7%B1%BB)
11. [v ä¿®é¥°ç¬¦ï¼šUnicode å±æ€§ç±»çš„è¿ç®—](https://es6.ruanyifeng.com/#docs/regex#v%20%E4%BF%AE%E9%A5%B0%E7%AC%A6%EF%BC%9AUnicode%20%E5%B1%9E%E6%80%A7%E7%B1%BB%E7%9A%84%E8%BF%90%E7%AE%97)
12. [å…·åç»„åŒ¹é…](https://es6.ruanyifeng.com/#docs/regex#%E5%85%B7%E5%90%8D%E7%BB%84%E5%8C%B9%E9%85%8D)
13. [d ä¿®é¥°ç¬¦ï¼šæ­£åˆ™åŒ¹é…ç´¢å¼•](https://es6.ruanyifeng.com/#docs/regex#d%20%E4%BF%AE%E9%A5%B0%E7%AC%A6%EF%BC%9A%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D%E7%B4%A2%E5%BC%95)
14. [String.prototype.matchAll()](<https://es6.ruanyifeng.com/#docs/regex#String.prototype.matchAll() $

## RegExp æ„é€ å‡½æ•°

åœ¨ ES5 ä¸­ï¼Œ`RegExp`æ„é€ å‡½æ•°çš„å‚æ•°æœ‰ä¸¤ç§æƒ…å†µã€‚

ç¬¬ä¸€ç§æƒ…å†µæ˜¯ï¼Œå‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œè¿™æ—¶ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦ï¼ˆflagï¼‰ã€‚

```
var regex = new RegExp('xyz', 'i');
// ç­‰ä»·äº
var regex = /xyz/i;
```

ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨ç¤ºå¼ï¼Œè¿™æ—¶ä¼šè¿”å›ä¸€ä¸ªåŸæœ‰æ­£åˆ™è¡¨è¾¾å¼çš„æ‹·è´ã€‚

```
var regex = new RegExp(/xyz/i);
// ç­‰ä»·äº
var regex = /xyz/i;
```

ä½†æ˜¯ï¼ŒES5 ä¸å…è®¸æ­¤æ—¶ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°æ·»åŠ ä¿®é¥°ç¬¦ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚

```
var regex = new RegExp(/xyz/, 'i');
// Uncaught TypeError: Cannot supply flags when constructing one RegExp from another
```

ES6 æ”¹å˜äº†è¿™ç§è¡Œä¸ºã€‚å¦‚æœ`RegExp`æ„é€ å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ­£åˆ™å¯¹è±¡ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šä¿®é¥°ç¬¦ã€‚è€Œä¸”ï¼Œè¿”å›çš„æ­£åˆ™è¡¨è¾¾å¼ä¼šå¿½ç•¥åŸæœ‰çš„æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦ï¼Œåªä½¿ç”¨æ–°æŒ‡å®šçš„ä¿®é¥°ç¬¦ã€‚

```
new RegExp(/abc/ig, 'i').flags
// "i"
```

ä¸Šé¢ä»£ç ä¸­ï¼ŒåŸæœ‰æ­£åˆ™å¯¹è±¡çš„ä¿®é¥°ç¬¦æ˜¯`ig`ï¼Œå®ƒä¼šè¢«ç¬¬äºŒä¸ªå‚æ•°`i`è¦†ç›–ã€‚

## å­—ç¬¦ä¸²çš„æ­£åˆ™æ–¹æ³•

ES6 å‡ºç°ä¹‹å‰ï¼Œå­—ç¬¦ä¸²å¯¹è±¡å…±æœ‰ 4 ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼š`match()`ã€`replace()`ã€`search()`å’Œ`split()`ã€‚

ES6 å°†è¿™ 4 ä¸ªæ–¹æ³•ï¼Œåœ¨è¯­è¨€å†…éƒ¨å…¨éƒ¨è°ƒç”¨`RegExp`çš„å®ä¾‹æ–¹æ³•ï¼Œä»è€Œåšåˆ°æ‰€æœ‰ä¸æ­£åˆ™ç›¸å…³çš„æ–¹æ³•ï¼Œå…¨éƒ½å®šä¹‰åœ¨`RegExp`å¯¹è±¡ä¸Šã€‚

- `String.prototype.match` è°ƒç”¨ `RegExp.prototype[Symbol.match]`
- `String.prototype.replace` è°ƒç”¨ `RegExp.prototype[Symbol.replace]`
- `String.prototype.search` è°ƒç”¨ `RegExp.prototype[Symbol.search]`
- `String.prototype.split` è°ƒç”¨ `RegExp.prototype[Symbol.split]`

## u ä¿®é¥°ç¬¦

ES6 å¯¹æ­£åˆ™è¡¨è¾¾å¼æ·»åŠ äº†`u`ä¿®é¥°ç¬¦ï¼Œå«ä¹‰ä¸ºâ€œUnicode æ¨¡å¼â€ï¼Œç”¨æ¥æ­£ç¡®å¤„ç†å¤§äº`\uFFFF`çš„ Unicode å­—ç¬¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šæ­£ç¡®å¤„ç†å››ä¸ªå­—èŠ‚çš„ UTF-16 ç¼–ç ã€‚

```
/^\uD83D/u.test('\uD83D\uDC2A') // false
/^\uD83D/.test('\uD83D\uDC2A') // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`\uD83D\uDC2A`æ˜¯ä¸€ä¸ªå››ä¸ªå­—èŠ‚çš„ UTF-16 ç¼–ç ï¼Œä»£è¡¨ä¸€ä¸ªå­—ç¬¦ã€‚ä½†æ˜¯ï¼ŒES5 ä¸æ”¯æŒå››ä¸ªå­—èŠ‚çš„ UTF-16 ç¼–ç ï¼Œä¼šå°†å…¶è¯†åˆ«ä¸ºä¸¤ä¸ªå­—ç¬¦ï¼Œå¯¼è‡´ç¬¬äºŒè¡Œä»£ç ç»“æœä¸º`true`ã€‚åŠ äº†`u`ä¿®é¥°ç¬¦ä»¥åï¼ŒES6 å°±ä¼šè¯†åˆ«å…¶ä¸ºä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ç¬¬ä¸€è¡Œä»£ç ç»“æœä¸º`false`ã€‚

ä¸€æ—¦åŠ ä¸Š`u`ä¿®é¥°ç¬¦å·ï¼Œå°±ä¼šä¿®æ”¹ä¸‹é¢è¿™äº›æ­£åˆ™è¡¨è¾¾å¼çš„è¡Œä¸ºã€‚

**ï¼ˆ1ï¼‰ç‚¹å­—ç¬¦**

ç‚¹ï¼ˆ`.`ï¼‰å­—ç¬¦åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œå«ä¹‰æ˜¯é™¤äº†æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦ã€‚å¯¹äºç ç‚¹å¤§äº`0xFFFF`çš„ Unicode å­—ç¬¦ï¼Œç‚¹å­—ç¬¦ä¸èƒ½è¯†åˆ«ï¼Œå¿…é¡»åŠ ä¸Š`u`ä¿®é¥°ç¬¦ã€‚

```
var s = 'ğ ®·';

/^.$/.test(s) // false
/^.$/u.test(s) // true
```

ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œå¦‚æœä¸æ·»åŠ `u`ä¿®é¥°ç¬¦ï¼Œæ­£åˆ™è¡¨è¾¾å¼å°±ä¼šè®¤ä¸ºå­—ç¬¦ä¸²ä¸ºä¸¤ä¸ªå­—ç¬¦ï¼Œä»è€ŒåŒ¹é…å¤±è´¥ã€‚

**ï¼ˆ2ï¼‰Unicode å­—ç¬¦è¡¨ç¤ºæ³•**

ES6 æ–°å¢äº†ä½¿ç”¨å¤§æ‹¬å·è¡¨ç¤º Unicode å­—ç¬¦ï¼Œè¿™ç§è¡¨ç¤ºæ³•åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­å¿…é¡»åŠ ä¸Š`u`ä¿®é¥°ç¬¦ï¼Œæ‰èƒ½è¯†åˆ«å½“ä¸­çš„å¤§æ‹¬å·ï¼Œå¦åˆ™ä¼šè¢«è§£è¯»ä¸ºé‡è¯ã€‚

```
/\u{61}/.test('a') // false
/\u{61}/u.test('a') // true
/\u{20BB7}/u.test('ğ ®·') // true
```

ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œå¦‚æœä¸åŠ `u`ä¿®é¥°ç¬¦ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ— æ³•è¯†åˆ«`\u{61}`è¿™ç§è¡¨ç¤ºæ³•ï¼Œåªä¼šè®¤ä¸ºè¿™åŒ¹é… 61 ä¸ªè¿ç»­çš„`u`ã€‚

**ï¼ˆ3ï¼‰é‡è¯**

ä½¿ç”¨`u`ä¿®é¥°ç¬¦åï¼Œæ‰€æœ‰é‡è¯éƒ½ä¼šæ­£ç¡®è¯†åˆ«ç ç‚¹å¤§äº`0xFFFF`çš„ Unicode å­—ç¬¦ã€‚

```
/a{2}/.test('aa') // true
/a{2}/u.test('aa') // true
/ğ ®·{2}/.test('ğ ®·ğ ®·') // false
/ğ ®·{2}/u.test('ğ ®·ğ ®·') // true
```

**ï¼ˆ4ï¼‰é¢„å®šä¹‰æ¨¡å¼**

`u`ä¿®é¥°ç¬¦ä¹Ÿå½±å“åˆ°é¢„å®šä¹‰æ¨¡å¼ï¼Œèƒ½å¦æ­£ç¡®è¯†åˆ«ç ç‚¹å¤§äº`0xFFFF`çš„ Unicode å­—ç¬¦ã€‚

```
/^\S$/.test('ğ ®·') // false
/^\S$/u.test('ğ ®·') // true
```

ä¸Šé¢ä»£ç çš„`\S`æ˜¯é¢„å®šä¹‰æ¨¡å¼ï¼ŒåŒ¹é…æ‰€æœ‰éç©ºç™½å­—ç¬¦ã€‚åªæœ‰åŠ äº†`u`ä¿®é¥°ç¬¦ï¼Œå®ƒæ‰èƒ½æ­£ç¡®åŒ¹é…ç ç‚¹å¤§äº`0xFFFF`çš„ Unicode å­—ç¬¦ã€‚

åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå¯ä»¥å†™å‡ºä¸€ä¸ªæ­£ç¡®è¿”å›å­—ç¬¦ä¸²é•¿åº¦çš„å‡½æ•°ã€‚

```
function codePointLength(text) {
  var result = text.match(/[\s\S]/gu);
  return result ? result.length : 0;
}

var s = 'ğ ®·ğ ®·';

s.length // 4
codePointLength(s) // 2
```

**ï¼ˆ5ï¼‰i ä¿®é¥°ç¬¦**

æœ‰äº› Unicode å­—ç¬¦çš„ç¼–ç ä¸åŒï¼Œä½†æ˜¯å­—å‹å¾ˆç›¸è¿‘ï¼Œæ¯”å¦‚ï¼Œ`\u004B`ä¸`\u212A`éƒ½æ˜¯å¤§å†™çš„`K`ã€‚

```
/[a-z]/i.test('\u212A') // false
/[a-z]/iu.test('\u212A') // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œä¸åŠ `u`ä¿®é¥°ç¬¦ï¼Œå°±æ— æ³•è¯†åˆ«éè§„èŒƒçš„`K`å­—ç¬¦ã€‚

**ï¼ˆ6ï¼‰è½¬ä¹‰**

æ²¡æœ‰`u`ä¿®é¥°ç¬¦çš„æƒ…å†µä¸‹ï¼Œæ­£åˆ™ä¸­æ²¡æœ‰å®šä¹‰çš„è½¬ä¹‰ï¼ˆå¦‚é€—å·çš„è½¬ä¹‰`\,`ï¼‰æ— æ•ˆï¼Œè€Œåœ¨`u`æ¨¡å¼ä¼šæŠ¥é”™ã€‚

```
/\,/ // /\,/
/\,/u // æŠ¥é”™
```

ä¸Šé¢ä»£ç ä¸­ï¼Œæ²¡æœ‰`u`ä¿®é¥°ç¬¦æ—¶ï¼Œé€—å·å‰é¢çš„åæ–œæ æ˜¯æ— æ•ˆçš„ï¼ŒåŠ äº†`u`ä¿®é¥°ç¬¦å°±æŠ¥é”™ã€‚

## RegExp.prototype.unicode å±æ€§

æ­£åˆ™å®ä¾‹å¯¹è±¡æ–°å¢`unicode`å±æ€§ï¼Œè¡¨ç¤ºæ˜¯å¦è®¾ç½®äº†`u`ä¿®é¥°ç¬¦ã€‚

```
const r1 = /hello/;
const r2 = /hello/u;

r1.unicode // false
r2.unicode // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦è®¾ç½®äº†`u`ä¿®é¥°ç¬¦ï¼Œå¯ä»¥ä»`unicode`å±æ€§çœ‹å‡ºæ¥ã€‚

## y ä¿®é¥°ç¬¦

é™¤äº†`u`ä¿®é¥°ç¬¦ï¼ŒES6 è¿˜ä¸ºæ­£åˆ™è¡¨è¾¾å¼æ·»åŠ äº†`y`ä¿®é¥°ç¬¦ï¼Œå«åšâ€œç²˜è¿â€ï¼ˆstickyï¼‰ä¿®é¥°ç¬¦ã€‚

`y`ä¿®é¥°ç¬¦çš„ä½œç”¨ä¸`g`ä¿®é¥°ç¬¦ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å…¨å±€åŒ¹é…ï¼Œåä¸€æ¬¡åŒ¹é…éƒ½ä»ä¸Šä¸€æ¬¡åŒ¹é…æˆåŠŸçš„ä¸‹ä¸€ä¸ªä½ç½®å¼€å§‹ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œ`g`ä¿®é¥°ç¬¦åªè¦å‰©ä½™ä½ç½®ä¸­å­˜åœ¨åŒ¹é…å°±å¯ï¼Œè€Œ`y`ä¿®é¥°ç¬¦ç¡®ä¿åŒ¹é…å¿…é¡»ä»å‰©ä½™çš„ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹ï¼Œè¿™ä¹Ÿå°±æ˜¯â€œç²˜è¿â€çš„æ¶µä¹‰ã€‚

```
var s = 'aaa_aa_a';
var r1 = /a+/g;
var r2 = /a+/y;

r1.exec(s) // ["aaa"]
r2.exec(s) // ["aaa"]

r1.exec(s) // ["aa"]
r2.exec(s) // null
```

ä¸Šé¢ä»£ç æœ‰ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸€ä¸ªä½¿ç”¨`g`ä¿®é¥°ç¬¦ï¼Œå¦ä¸€ä¸ªä½¿ç”¨`y`ä¿®é¥°ç¬¦ã€‚è¿™ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼å„æ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸¤è€…è¡Œä¸ºç›¸åŒï¼Œå‰©ä½™å­—ç¬¦ä¸²éƒ½æ˜¯`_aa_a`ã€‚ç”±äº`g`ä¿®é¥°æ²¡æœ‰ä½ç½®è¦æ±‚ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡æ‰§è¡Œä¼šè¿”å›ç»“æœï¼Œè€Œ`y`ä¿®é¥°ç¬¦è¦æ±‚åŒ¹é…å¿…é¡»ä»å¤´éƒ¨å¼€å§‹ï¼Œæ‰€ä»¥è¿”å›`null`ã€‚

å¦‚æœæ”¹ä¸€ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¿è¯æ¯æ¬¡éƒ½èƒ½å¤´éƒ¨åŒ¹é…ï¼Œ`y`ä¿®é¥°ç¬¦å°±ä¼šè¿”å›ç»“æœäº†ã€‚

```
var s = 'aaa_aa_a';
var r = /a+_/y;

r.exec(s) // ["aaa_"]
r.exec(s) // ["aa_"]
```

ä¸Šé¢ä»£ç æ¯æ¬¡åŒ¹é…ï¼Œéƒ½æ˜¯ä»å‰©ä½™å­—ç¬¦ä¸²çš„å¤´éƒ¨å¼€å§‹ã€‚

ä½¿ç”¨`lastIndex`å±æ€§ï¼Œå¯ä»¥æ›´å¥½åœ°è¯´æ˜`y`ä¿®é¥°ç¬¦ã€‚

```
const REGEX = /a/g;

// æŒ‡å®šä»2å·ä½ç½®ï¼ˆyï¼‰å¼€å§‹åŒ¹é…
REGEX.lastIndex = 2;

// åŒ¹é…æˆåŠŸ
const match = REGEX.exec('xaya');

// åœ¨3å·ä½ç½®åŒ¹é…æˆåŠŸ
match.index // 3

// ä¸‹ä¸€æ¬¡åŒ¹é…ä»4å·ä½å¼€å§‹
REGEX.lastIndex // 4

// 4å·ä½å¼€å§‹åŒ¹é…å¤±è´¥
REGEX.exec('xaya') // null
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`lastIndex`å±æ€§æŒ‡å®šæ¯æ¬¡æœç´¢çš„å¼€å§‹ä½ç½®ï¼Œ`g`ä¿®é¥°ç¬¦ä»è¿™ä¸ªä½ç½®å¼€å§‹å‘åæœç´¢ï¼Œç›´åˆ°å‘ç°åŒ¹é…ä¸ºæ­¢ã€‚

`y`ä¿®é¥°ç¬¦åŒæ ·éµå®ˆ`lastIndex`å±æ€§ï¼Œä½†æ˜¯è¦æ±‚å¿…é¡»åœ¨`lastIndex`æŒ‡å®šçš„ä½ç½®å‘ç°åŒ¹é…ã€‚

```
const REGEX = /a/y;

// æŒ‡å®šä»2å·ä½ç½®å¼€å§‹åŒ¹é…
REGEX.lastIndex = 2;

// ä¸æ˜¯ç²˜è¿ï¼ŒåŒ¹é…å¤±è´¥
REGEX.exec('xaya') // null

// æŒ‡å®šä»3å·ä½ç½®å¼€å§‹åŒ¹é…
REGEX.lastIndex = 3;

// 3å·ä½ç½®æ˜¯ç²˜è¿ï¼ŒåŒ¹é…æˆåŠŸ
const match = REGEX.exec('xaya');
match.index // 3
REGEX.lastIndex // 4
```

å®é™…ä¸Šï¼Œ`y`ä¿®é¥°ç¬¦å·éšå«äº†å¤´éƒ¨åŒ¹é…çš„æ ‡å¿—`^`ã€‚

```
/b/y.exec('aba')
// null
```

ä¸Šé¢ä»£ç ç”±äºä¸èƒ½ä¿è¯å¤´éƒ¨åŒ¹é…ï¼Œæ‰€ä»¥è¿”å›`null`ã€‚`y`ä¿®é¥°ç¬¦çš„è®¾è®¡æœ¬æ„ï¼Œå°±æ˜¯è®©å¤´éƒ¨åŒ¹é…çš„æ ‡å¿—`^`åœ¨å…¨å±€åŒ¹é…ä¸­éƒ½æœ‰æ•ˆã€‚

ä¸‹é¢æ˜¯å­—ç¬¦ä¸²å¯¹è±¡çš„`replace`æ–¹æ³•çš„ä¾‹å­ã€‚

```
const REGEX = /a/gy;
'aaxa'.replace(REGEX, '-') // '--xa'
```

ä¸Šé¢ä»£ç ä¸­ï¼Œæœ€åä¸€ä¸ª`a`å› ä¸ºä¸æ˜¯å‡ºç°åœ¨ä¸‹ä¸€æ¬¡åŒ¹é…çš„å¤´éƒ¨ï¼Œæ‰€ä»¥ä¸ä¼šè¢«æ›¿æ¢ã€‚

å•å•ä¸€ä¸ª`y`ä¿®é¥°ç¬¦å¯¹`match`æ–¹æ³•ï¼Œåªèƒ½è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…ï¼Œå¿…é¡»ä¸`g`ä¿®é¥°ç¬¦è”ç”¨ï¼Œæ‰èƒ½è¿”å›æ‰€æœ‰åŒ¹é…ã€‚

```
'a1a2a3'.match(/a\d/y) // ["a1"]
'a1a2a3'.match(/a\d/gy) // ["a1", "a2", "a3"]
```

`y`ä¿®é¥°ç¬¦çš„ä¸€ä¸ªåº”ç”¨ï¼Œæ˜¯ä»å­—ç¬¦ä¸²æå– tokenï¼ˆè¯å…ƒï¼‰ï¼Œ`y`ä¿®é¥°ç¬¦ç¡®ä¿äº†åŒ¹é…ä¹‹é—´ä¸ä¼šæœ‰æ¼æ‰çš„å­—ç¬¦ã€‚

```
const TOKEN_Y = /\s*(\+|[0-9]+)\s*/y;
const TOKEN_G  = /\s*(\+|[0-9]+)\s*/g;

tokenize(TOKEN_Y, '3 + 4')
// [ '3', '+', '4' ]
tokenize(TOKEN_G, '3 + 4')
// [ '3', '+', '4' ]

function tokenize(TOKEN_REGEX, str) {
  let result = [];
  let match;
  while (match = TOKEN_REGEX.exec(str)) {
    result.push(match[1]);
  }
  return result;
}
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœå­—ç¬¦ä¸²é‡Œé¢æ²¡æœ‰éæ³•å­—ç¬¦ï¼Œ`y`ä¿®é¥°ç¬¦ä¸`g`ä¿®é¥°ç¬¦çš„æå–ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦å‡ºç°éæ³•å­—ç¬¦ï¼Œä¸¤è€…çš„è¡Œä¸ºå°±ä¸ä¸€æ ·äº†ã€‚

```
tokenize(TOKEN_Y, '3x + 4')
// [ '3' ]
tokenize(TOKEN_G, '3x + 4')
// [ '3', '+', '4' ]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`g`ä¿®é¥°ç¬¦ä¼šå¿½ç•¥éæ³•å­—ç¬¦ï¼Œè€Œ`y`ä¿®é¥°ç¬¦ä¸ä¼šï¼Œè¿™æ ·å°±å¾ˆå®¹æ˜“å‘ç°é”™è¯¯ã€‚

## RegExp.prototype.sticky å±æ€§

ä¸`y`ä¿®é¥°ç¬¦ç›¸åŒ¹é…ï¼ŒES6 çš„æ­£åˆ™å®ä¾‹å¯¹è±¡å¤šäº†`sticky`å±æ€§ï¼Œè¡¨ç¤ºæ˜¯å¦è®¾ç½®äº†`y`ä¿®é¥°ç¬¦ã€‚

```
var r = /hello\d/y;
r.sticky // true
```

## RegExp.prototype.flags å±æ€§

ES6 ä¸ºæ­£åˆ™è¡¨è¾¾å¼æ–°å¢äº†`flags`å±æ€§ï¼Œä¼šè¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦ã€‚

```
// ES5 çš„ source å±æ€§
// è¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„æ­£æ–‡
/abc/ig.source
// "abc"

// ES6 çš„ flags å±æ€§
// è¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦
/abc/ig.flags
// 'gi'
```

## s ä¿®é¥°ç¬¦ï¼šdotAll æ¨¡å¼

æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œç‚¹ï¼ˆ`.`ï¼‰æ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œä»£è¡¨ä»»æ„çš„å•ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªä¾‹å¤–ã€‚ä¸€ä¸ªæ˜¯å››ä¸ªå­—èŠ‚çš„ UTF-16 å­—ç¬¦ï¼Œè¿™ä¸ªå¯ä»¥ç”¨`u`ä¿®é¥°ç¬¦è§£å†³ï¼›å¦ä¸€ä¸ªæ˜¯è¡Œç»ˆæ­¢ç¬¦ï¼ˆline terminator characterï¼‰ã€‚

æ‰€è°“è¡Œç»ˆæ­¢ç¬¦ï¼Œå°±æ˜¯è¯¥å­—ç¬¦è¡¨ç¤ºä¸€è¡Œçš„ç»ˆç»“ã€‚ä»¥ä¸‹å››ä¸ªå­—ç¬¦å±äºâ€œè¡Œç»ˆæ­¢ç¬¦â€ã€‚

- U+000A æ¢è¡Œç¬¦ï¼ˆ`\n`ï¼‰
- U+000D å›è½¦ç¬¦ï¼ˆ`\r`ï¼‰
- U+2028 è¡Œåˆ†éš”ç¬¦ï¼ˆline separatorï¼‰
- U+2029 æ®µåˆ†éš”ç¬¦ï¼ˆparagraph separatorï¼‰

```
/foo.bar/.test('foo\nbar')
// false
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå› ä¸º`.`ä¸åŒ¹é…`\n`ï¼Œæ‰€ä»¥æ­£åˆ™è¡¨è¾¾å¼è¿”å›`false`ã€‚

ä½†æ˜¯ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›åŒ¹é…çš„æ˜¯ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œè¿™æ—¶æœ‰ä¸€ç§å˜é€šçš„å†™æ³•ã€‚

```
/foo[^]bar/.test('foo\nbar')
// true
```

è¿™ç§è§£å†³æ–¹æ¡ˆæ¯•ç«Ÿä¸å¤ªç¬¦åˆç›´è§‰ï¼ŒES2018 [å¼•å…¥](https://github.com/tc39/proposal-regexp-dotall-flag)`s`ä¿®é¥°ç¬¦ï¼Œä½¿å¾—`.`å¯ä»¥åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ã€‚

```
/foo.bar/s.test('foo\nbar') // true
```

è¿™è¢«ç§°ä¸º`dotAll`æ¨¡å¼ï¼Œå³ç‚¹ï¼ˆdotï¼‰ä»£è¡¨ä¸€åˆ‡å­—ç¬¦ã€‚æ‰€ä»¥ï¼Œæ­£åˆ™è¡¨è¾¾å¼è¿˜å¼•å…¥äº†ä¸€ä¸ª`dotAll`å±æ€§ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦å¤„åœ¨`dotAll`æ¨¡å¼ã€‚

```
const re = /foo.bar/s;
// å¦ä¸€ç§å†™æ³•
// const re = new RegExp('foo.bar', 's');

re.test('foo\nbar') // true
re.dotAll // true
re.flags // 's'
```

`/s`ä¿®é¥°ç¬¦å’Œå¤šè¡Œä¿®é¥°ç¬¦`/m`ä¸å†²çªï¼Œä¸¤è€…ä¸€èµ·ä½¿ç”¨çš„æƒ…å†µä¸‹ï¼Œ`.`åŒ¹é…æ‰€æœ‰å­—ç¬¦ï¼Œè€Œ`^`å’Œ`$`åŒ¹é…æ¯ä¸€è¡Œçš„è¡Œé¦–å’Œè¡Œå°¾ã€‚

## åè¡Œæ–­è¨€

JavaScript è¯­è¨€çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œåªæ”¯æŒå…ˆè¡Œæ–­è¨€ï¼ˆlookaheadï¼‰å’Œå…ˆè¡Œå¦å®šæ–­è¨€ï¼ˆnegative lookaheadï¼‰ï¼Œä¸æ”¯æŒåè¡Œæ–­è¨€ï¼ˆlookbehindï¼‰å’Œåè¡Œå¦å®šæ–­è¨€ï¼ˆnegative lookbehindï¼‰ã€‚ES2018 å¼•å…¥[åè¡Œæ–­è¨€](https://github.com/tc39/proposal-regexp-lookbehind)ï¼ŒV8 å¼•æ“ 4.9 ç‰ˆï¼ˆChrome 62ï¼‰å·²ç»æ”¯æŒã€‚

â€œå…ˆè¡Œæ–­è¨€â€æŒ‡çš„æ˜¯ï¼Œ`x`åªæœ‰åœ¨`y`å‰é¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ`/x(?=y)/`ã€‚æ¯”å¦‚ï¼ŒåªåŒ¹é…ç™¾åˆ†å·ä¹‹å‰çš„æ•°å­—ï¼Œè¦å†™æˆ`/\d+(?=%)/`ã€‚â€œå…ˆè¡Œå¦å®šæ–­è¨€â€æŒ‡çš„æ˜¯ï¼Œ`x`åªæœ‰ä¸åœ¨`y`å‰é¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ`/x(?!y)/`ã€‚æ¯”å¦‚ï¼ŒåªåŒ¹é…ä¸åœ¨ç™¾åˆ†å·ä¹‹å‰çš„æ•°å­—ï¼Œè¦å†™æˆ`/\d+(?!%)/`ã€‚

```
/\d+(?=%)/.exec('100% of US presidents have been male')  // ["100"]
/\d+(?!%)/.exec('thatâ€™s all 44 of them')                 // ["44"]
```

ä¸Šé¢ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœäº’æ¢æ­£åˆ™è¡¨è¾¾å¼ï¼Œå°±ä¸ä¼šå¾—åˆ°ç›¸åŒç»“æœã€‚å¦å¤–ï¼Œè¿˜å¯ä»¥çœ‹åˆ°ï¼Œâ€œå…ˆè¡Œæ–­è¨€â€æ‹¬å·ä¹‹ä¸­çš„éƒ¨åˆ†ï¼ˆ`(?=%)`ï¼‰ï¼Œæ˜¯ä¸è®¡å…¥è¿”å›ç»“æœçš„ã€‚

â€œåè¡Œæ–­è¨€â€æ­£å¥½ä¸â€œå…ˆè¡Œæ–­è¨€â€ç›¸åï¼Œ`x`åªæœ‰åœ¨`y`åé¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ`/(?<=y)x/`ã€‚æ¯”å¦‚ï¼ŒåªåŒ¹é…ç¾å…ƒç¬¦å·ä¹‹åçš„æ•°å­—ï¼Œè¦å†™æˆ`/(?<=\$)\d+/`ã€‚â€œåè¡Œå¦å®šæ–­è¨€â€åˆ™ä¸â€œå…ˆè¡Œå¦å®šæ–­è¨€â€ç›¸åï¼Œ`x`åªæœ‰ä¸åœ¨`y`åé¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ`/(?<!y)x/`ã€‚æ¯”å¦‚ï¼ŒåªåŒ¹é…ä¸åœ¨ç¾å…ƒç¬¦å·åé¢çš„æ•°å­—ï¼Œè¦å†™æˆ`/(?<!\$)\d+/`ã€‚

```
/(?<=\$)\d+/.exec('Benjamin Franklin is on the $100 bill')  // ["100"]
/(?<!\$)\d+/.exec('itâ€™s is worth about â‚¬90')                // ["90"]
```

ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œâ€œåè¡Œæ–­è¨€â€çš„æ‹¬å·ä¹‹ä¸­çš„éƒ¨åˆ†ï¼ˆ`(?<=\$)`ï¼‰ï¼Œä¹Ÿæ˜¯ä¸è®¡å…¥è¿”å›ç»“æœã€‚

ä¸‹é¢çš„ä¾‹å­æ˜¯ä½¿ç”¨åè¡Œæ–­è¨€è¿›è¡Œå­—ç¬¦ä¸²æ›¿æ¢ã€‚

```
const RE_DOLLAR_PREFIX = /(?<=\$)foo/g;
'$foo %foo foo'.replace(RE_DOLLAR_PREFIX, 'bar');
// '$bar %foo foo'
```

ä¸Šé¢ä»£ç ä¸­ï¼Œåªæœ‰åœ¨ç¾å…ƒç¬¦å·åé¢çš„`foo`æ‰ä¼šè¢«æ›¿æ¢ã€‚

â€œåè¡Œæ–­è¨€â€çš„å®ç°ï¼Œéœ€è¦å…ˆåŒ¹é…`/(?<=y)x/`çš„`x`ï¼Œç„¶åå†å›åˆ°å·¦è¾¹ï¼ŒåŒ¹é…`y`çš„éƒ¨åˆ†ã€‚è¿™ç§â€œå…ˆå³åå·¦â€çš„æ‰§è¡Œé¡ºåºï¼Œä¸æ‰€æœ‰å…¶ä»–æ­£åˆ™æ“ä½œç›¸åï¼Œå¯¼è‡´äº†ä¸€äº›ä¸ç¬¦åˆé¢„æœŸçš„è¡Œä¸ºã€‚

é¦–å…ˆï¼Œåè¡Œæ–­è¨€çš„ç»„åŒ¹é…ï¼Œä¸æ­£å¸¸æƒ…å†µä¸‹ç»“æœæ˜¯ä¸ä¸€æ ·çš„ã€‚

```
/(?<=(\d+)(\d+))$/.exec('1053') // ["", "1", "053"]
/^(\d+)(\d+)$/.exec('1053') // ["1053", "105", "3"]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œéœ€è¦æ•æ‰ä¸¤ä¸ªç»„åŒ¹é…ã€‚æ²¡æœ‰â€œåè¡Œæ–­è¨€â€æ—¶ï¼Œç¬¬ä¸€ä¸ªæ‹¬å·æ˜¯è´ªå©ªæ¨¡å¼ï¼Œç¬¬äºŒä¸ªæ‹¬å·åªèƒ½æ•è·ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ç»“æœæ˜¯`105`å’Œ`3`ã€‚è€Œâ€œåè¡Œæ–­è¨€â€æ—¶ï¼Œç”±äºæ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦ï¼Œç¬¬äºŒä¸ªæ‹¬å·æ˜¯è´ªå©ªæ¨¡å¼ï¼Œç¬¬ä¸€ä¸ªæ‹¬å·åªèƒ½æ•è·ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ç»“æœæ˜¯`1`å’Œ`053`ã€‚

å…¶æ¬¡ï¼Œâ€œåè¡Œæ–­è¨€â€çš„åæ–œæ å¼•ç”¨ï¼Œä¹Ÿä¸é€šå¸¸çš„é¡ºåºç›¸åï¼Œå¿…é¡»æ”¾åœ¨å¯¹åº”çš„é‚£ä¸ªæ‹¬å·ä¹‹å‰ã€‚

```
/(?<=(o)d\1)r/.exec('hodor')  // null
/(?<=\1d(o))r/.exec('hodor')  // ["r", "o"]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœåè¡Œæ–­è¨€çš„åæ–œæ å¼•ç”¨ï¼ˆ`\1`ï¼‰æ”¾åœ¨æ‹¬å·çš„åé¢ï¼Œå°±ä¸ä¼šå¾—åˆ°åŒ¹é…ç»“æœï¼Œå¿…é¡»æ”¾åœ¨å‰é¢æ‰å¯ä»¥ã€‚å› ä¸ºåè¡Œæ–­è¨€æ˜¯å…ˆä»å·¦åˆ°å³æ‰«æï¼Œå‘ç°åŒ¹é…ä»¥åå†å›è¿‡å¤´ï¼Œä»å³åˆ°å·¦å®Œæˆåæ–œæ å¼•ç”¨ã€‚

## Unicode å±æ€§ç±»

ES2018 [å¼•å…¥](https://github.com/tc39/proposal-regexp-unicode-property-escapes)äº† Unicode å±æ€§ç±»ï¼Œå…è®¸ä½¿ç”¨`\p{...}`å’Œ`\P{...}`ï¼ˆ`\P`æ˜¯`\p`çš„å¦å®šå½¢å¼ï¼‰ä»£è¡¨ä¸€ç±» Unicode å­—ç¬¦ï¼ŒåŒ¹é…æ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰å­—ç¬¦ã€‚

```
const regexGreekSymbol = /\p{Script=Greek}/u;
regexGreekSymbol.test('Ï€') // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`\p{Script=Greek}`è¡¨ç¤ºåŒ¹é…ä¸€ä¸ªå¸Œè…Šæ–‡å­—æ¯ï¼Œæ‰€ä»¥åŒ¹é…`Ï€`æˆåŠŸã€‚

Unicode å±æ€§ç±»çš„æ ‡å‡†å½¢å¼ï¼Œéœ€è¦åŒæ—¶æŒ‡å®šå±æ€§åå’Œå±æ€§å€¼ã€‚

```
\p{UnicodePropertyName=UnicodePropertyValue}
```

ä½†æ˜¯ï¼Œå¯¹äºæŸäº›å±æ€§ï¼Œå¯ä»¥åªå†™å±æ€§åï¼Œæˆ–è€…åªå†™å±æ€§å€¼ã€‚

```
\p{UnicodePropertyName}
\p{UnicodePropertyValue}
```

`\P{â€¦}`æ˜¯`\p{â€¦}`çš„åå‘åŒ¹é…ï¼Œå³åŒ¹é…ä¸æ»¡è¶³æ¡ä»¶çš„å­—ç¬¦ã€‚

æ³¨æ„ï¼Œè¿™ä¸¤ç§ç±»åªå¯¹ Unicode æœ‰æ•ˆï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™ä¸€å®šè¦åŠ ä¸Š`u`ä¿®é¥°ç¬¦ã€‚å¦‚æœä¸åŠ `u`ä¿®é¥°ç¬¦ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨`\p`å’Œ`\P`ä¼šæŠ¥é”™ã€‚

ç”±äº Unicode çš„å„ç§å±æ€§éå¸¸å¤šï¼Œæ‰€ä»¥è¿™ç§æ–°çš„ç±»çš„è¡¨è¾¾èƒ½åŠ›éå¸¸å¼ºã€‚

```
const regex = /^\p{Decimal_Number}+$/u;
regex.test('ğŸğŸğŸ‘ğŸœğŸğŸğŸ©ğŸªğŸ«ğŸ¬ğŸ­ğŸ®ğŸ¯ğŸºğŸ»ğŸ¼') // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå±æ€§ç±»æŒ‡å®šåŒ¹é…æ‰€æœ‰åè¿›åˆ¶å­—ç¬¦ï¼Œå¯ä»¥çœ‹åˆ°å„ç§å­—å‹çš„åè¿›åˆ¶å­—ç¬¦éƒ½ä¼šåŒ¹é…æˆåŠŸã€‚

`\p{Number}`ç”šè‡³èƒ½åŒ¹é…ç½—é©¬æ•°å­—ã€‚

```
// åŒ¹é…æ‰€æœ‰æ•°å­—
const regex = /^\p{Number}+$/u;
regex.test('Â²Â³Â¹Â¼Â½Â¾') // true
regex.test('ã‰›ã‰œã‰') // true
regex.test('â… â…¡â…¢â…£â…¤â…¥â…¦â…§â…¨â…©â…ªâ…«') // true
```

ä¸‹é¢æ˜¯å…¶ä»–ä¸€äº›ä¾‹å­ã€‚

```
// åŒ¹é…æ‰€æœ‰ç©ºæ ¼
\p{White_Space}

// åŒ¹é…å„ç§æ–‡å­—çš„æ‰€æœ‰å­—æ¯ï¼Œç­‰åŒäº Unicode ç‰ˆçš„ \w
[\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Connector_Punctuation}\p{Join_Control}]

// åŒ¹é…å„ç§æ–‡å­—çš„æ‰€æœ‰éå­—æ¯çš„å­—ç¬¦ï¼Œç­‰åŒäº Unicode ç‰ˆçš„ \W
[^\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Connector_Punctuation}\p{Join_Control}]

// åŒ¹é… Emoji
/\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation}|\p{Emoji}\uFE0F/gu

// åŒ¹é…æ‰€æœ‰çš„ç®­å¤´å­—ç¬¦
const regexArrows = /^\p{Block=Arrows}+$/u;
regexArrows.test('â†â†‘â†’â†“â†”â†•â†–â†—â†˜â†™â‡â‡â‡‘â‡’â‡“â‡”â‡•â‡–â‡—â‡˜â‡™â‡§â‡©') // true
```

## v ä¿®é¥°ç¬¦ï¼šUnicode å±æ€§ç±»çš„è¿ç®—

æœ‰æ—¶ï¼Œéœ€è¦å‘æŸä¸ª Unicode å±æ€§ç±»æ·»åŠ æˆ–å‡å°‘å­—ç¬¦ï¼Œå³éœ€è¦å¯¹å±æ€§ç±»è¿›è¡Œè¿ç®—ã€‚ç°åœ¨æœ‰ä¸€ä¸ª[ææ¡ˆ](https://github.com/tc39/proposal-regexp-v-flag)ï¼Œå¢åŠ äº† Unicode å±æ€§ç±»çš„è¿ç®—åŠŸèƒ½ã€‚

å®ƒæä¾›ä¸¤ç§å½¢å¼çš„è¿ç®—ï¼Œä¸€ç§æ˜¯å·®é›†è¿ç®—ï¼ˆA é›†åˆå‡å» B é›†åˆï¼‰ï¼Œå¦ä¸€ç§æ˜¯äº¤é›†è¿ç®—ã€‚

```
// å·®é›†è¿ç®—ï¼ˆA å‡å» Bï¼‰
[A--B]

// äº¤é›†è¿ç®—ï¼ˆA ä¸ B çš„äº¤é›†ï¼‰
[A&&B]
```

ä¸Šé¢ä¸¤ç§å†™æ³•ä¸­ï¼ŒA å’Œ B è¦ä¹ˆæ˜¯å­—ç¬¦ç±»ï¼ˆä¾‹å¦‚`[a-z]`ï¼‰ï¼Œè¦ä¹ˆæ˜¯ Unicode å±æ€§ç±»ï¼ˆä¾‹å¦‚`\p{ASCII}`ï¼‰ã€‚

è€Œä¸”ï¼Œè¿™ç§è¿ç®—æ”¯æŒæ–¹æ‹¬å·ä¹‹ä¸­åµŒå…¥æ–¹æ‹¬å·ï¼Œå³æ–¹æ‹¬å·çš„åµŒå¥—ã€‚

```
// æ–¹æ‹¬å·åµŒå¥—çš„ä¾‹å­
[A--[0-9]]
```

è¿™ç§è¿ç®—çš„å‰ææ˜¯ï¼Œæ­£åˆ™è¡¨è¾¾å¼å¿…é¡»ä½¿ç”¨æ–°å¼•å…¥çš„`v`ä¿®é¥°ç¬¦ã€‚å‰é¢è¯´è¿‡ï¼ŒUnicode å±æ€§ç±»å¿…é¡»æ­é…`u`ä¿®é¥°ç¬¦ä½¿ç”¨ï¼Œè¿™ä¸ª`v`ä¿®é¥°ç¬¦ç­‰äºä»£æ›¿`u`ï¼Œä½¿ç”¨äº†å®ƒå°±ä¸å¿…å†å†™`u`äº†ã€‚

ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ã€‚

```
// åè¿›åˆ¶å­—ç¬¦å»é™¤ ASCII ç çš„0åˆ°9
[\p{Decimal_Number}--[0-9]]

// Emoji å­—ç¬¦å»é™¤ ASCII ç å­—ç¬¦
[\p{Emoji}--\p{ASCII}]
```

## å…·åç»„åŒ¹é…

### ç®€ä»‹

æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨åœ†æ‹¬å·è¿›è¡Œç»„åŒ¹é…ã€‚

```
const RE_DATE = /(\d{4})-(\d{2})-(\d{2})/;
```

ä¸Šé¢ä»£ç ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼é‡Œé¢æœ‰ä¸‰ç»„åœ†æ‹¬å·ã€‚ä½¿ç”¨`exec`æ–¹æ³•ï¼Œå°±å¯ä»¥å°†è¿™ä¸‰ç»„åŒ¹é…ç»“æœæå–å‡ºæ¥ã€‚

```
const RE_DATE = /(\d{4})-(\d{2})-(\d{2})/;

const matchObj = RE_DATE.exec('1999-12-31');
const year = matchObj[1]; // 1999
const month = matchObj[2]; // 12
const day = matchObj[3]; // 31
```

ç»„åŒ¹é…çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæ¯ä¸€ç»„çš„åŒ¹é…å«ä¹‰ä¸å®¹æ˜“çœ‹å‡ºæ¥ï¼Œè€Œä¸”åªèƒ½ç”¨æ•°å­—åºå·ï¼ˆæ¯”å¦‚`matchObj[1]`ï¼‰å¼•ç”¨ï¼Œè¦æ˜¯ç»„çš„é¡ºåºå˜äº†ï¼Œå¼•ç”¨çš„æ—¶å€™å°±å¿…é¡»ä¿®æ”¹åºå·ã€‚

ES2018 å¼•å…¥äº†[å…·åç»„åŒ¹é…](https://github.com/tc39/proposal-regexp-named-groups)ï¼ˆNamed Capture Groupsï¼‰ï¼Œå…è®¸ä¸ºæ¯ä¸€ä¸ªç»„åŒ¹é…æŒ‡å®šä¸€ä¸ªåå­—ï¼Œæ—¢ä¾¿äºé˜…è¯»ä»£ç ï¼Œåˆä¾¿äºå¼•ç”¨ã€‚

```
const RE_DATE = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/;

const matchObj = RE_DATE.exec('1999-12-31');
const year = matchObj.groups.year; // "1999"
const month = matchObj.groups.month; // "12"
const day = matchObj.groups.day; // "31"
```

ä¸Šé¢ä»£ç ä¸­ï¼Œâ€œå…·åç»„åŒ¹é…â€åœ¨åœ†æ‹¬å·å†…éƒ¨ï¼Œæ¨¡å¼çš„å¤´éƒ¨æ·»åŠ â€œé—®å· + å°–æ‹¬å· + ç»„åâ€ï¼ˆ`?<year>`ï¼‰ï¼Œç„¶åå°±å¯ä»¥åœ¨`exec`æ–¹æ³•è¿”å›ç»“æœçš„`groups`å±æ€§ä¸Šå¼•ç”¨è¯¥ç»„åã€‚åŒæ—¶ï¼Œæ•°å­—åºå·ï¼ˆ`matchObj[1]`ï¼‰ä¾ç„¶æœ‰æ•ˆã€‚

å…·åç»„åŒ¹é…ç­‰äºä¸ºæ¯ä¸€ç»„åŒ¹é…åŠ ä¸Šäº† IDï¼Œä¾¿äºæè¿°åŒ¹é…çš„ç›®çš„ã€‚å¦‚æœç»„çš„é¡ºåºå˜äº†ï¼Œä¹Ÿä¸ç”¨æ”¹å˜åŒ¹é…åçš„å¤„ç†ä»£ç ã€‚

å¦‚æœå…·åç»„æ²¡æœ‰åŒ¹é…ï¼Œé‚£ä¹ˆå¯¹åº”çš„`groups`å¯¹è±¡å±æ€§ä¼šæ˜¯`undefined`ã€‚

```
const RE_OPT_A = /^(?<as>a+)?$/;
const matchObj = RE_OPT_A.exec('');

matchObj.groups.as // undefined
'as' in matchObj.groups // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå…·åç»„`as`æ²¡æœ‰æ‰¾åˆ°åŒ¹é…ï¼Œé‚£ä¹ˆ`matchObj.groups.as`å±æ€§å€¼å°±æ˜¯`undefined`ï¼Œå¹¶ä¸”`as`è¿™ä¸ªé”®ååœ¨`groups`æ˜¯å§‹ç»ˆå­˜åœ¨çš„ã€‚

### è§£æ„èµ‹å€¼å’Œæ›¿æ¢

æœ‰äº†å…·åç»„åŒ¹é…ä»¥åï¼Œå¯ä»¥ä½¿ç”¨è§£æ„èµ‹å€¼ç›´æ¥ä»åŒ¹é…ç»“æœä¸Šä¸ºå˜é‡èµ‹å€¼ã€‚

```
let {groups: {one, two}} = /^(?<one>.*):(?<two>.*)$/u.exec('foo:bar');
one  // foo
two  // bar
```

å­—ç¬¦ä¸²æ›¿æ¢æ—¶ï¼Œä½¿ç”¨`$<ç»„å>`å¼•ç”¨å…·åç»„ã€‚

```
let re = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/u;

'2015-01-02'.replace(re, '$<day>/$<month>/$<year>')
// '02/01/2015'
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`replace`æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚

`replace`æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„å‚æ•°åºåˆ—å¦‚ä¸‹ã€‚

```
'2015-01-02'.replace(re, (
   matched, // æ•´ä¸ªåŒ¹é…ç»“æœ 2015-01-02
   capture1, // ç¬¬ä¸€ä¸ªç»„åŒ¹é… 2015
   capture2, // ç¬¬äºŒä¸ªç»„åŒ¹é… 01
   capture3, // ç¬¬ä¸‰ä¸ªç»„åŒ¹é… 02
   position, // åŒ¹é…å¼€å§‹çš„ä½ç½® 0
   S, // åŸå­—ç¬¦ä¸² 2015-01-02
   groups // å…·åç»„æ„æˆçš„ä¸€ä¸ªå¯¹è±¡ {year, month, day}
 ) => {
 let {day, month, year} = groups;
 return `${day}/${month}/${year}`;
});
```

å…·åç»„åŒ¹é…åœ¨åŸæ¥çš„åŸºç¡€ä¸Šï¼Œæ–°å¢äº†æœ€åä¸€ä¸ªå‡½æ•°å‚æ•°ï¼šå…·åç»„æ„æˆçš„ä¸€ä¸ªå¯¹è±¡ã€‚å‡½æ•°å†…éƒ¨å¯ä»¥ç›´æ¥å¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œè§£æ„èµ‹å€¼ã€‚

### å¼•ç”¨

å¦‚æœè¦åœ¨æ­£åˆ™è¡¨è¾¾å¼å†…éƒ¨å¼•ç”¨æŸä¸ªâ€œå…·åç»„åŒ¹é…â€ï¼Œå¯ä»¥ä½¿ç”¨`\k<ç»„å>`çš„å†™æ³•ã€‚

```
const RE_TWICE = /^(?<word>[a-z]+)!\k<word>$/;
RE_TWICE.test('abc!abc') // true
RE_TWICE.test('abc!ab') // false
```

æ•°å­—å¼•ç”¨ï¼ˆ`\1`ï¼‰ä¾ç„¶æœ‰æ•ˆã€‚

```
const RE_TWICE = /^(?<word>[a-z]+)!\1$/;
RE_TWICE.test('abc!abc') // true
RE_TWICE.test('abc!ab') // false
```

è¿™ä¸¤ç§å¼•ç”¨è¯­æ³•è¿˜å¯ä»¥åŒæ—¶ä½¿ç”¨ã€‚

```
const RE_TWICE = /^(?<word>[a-z]+)!\k<word>!\1$/;
RE_TWICE.test('abc!abc!abc') // true
RE_TWICE.test('abc!abc!ab') // false
```

## d ä¿®é¥°ç¬¦ï¼šæ­£åˆ™åŒ¹é…ç´¢å¼•

ç»„åŒ¹é…çš„ç»“æœï¼Œåœ¨åŸå§‹å­—ç¬¦ä¸²é‡Œé¢çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ï¼Œç›®å‰è·å–å¹¶ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚æ­£åˆ™å®ä¾‹çš„`exec()`æ–¹æ³•æœ‰ä¸€ä¸ª`index`å±æ€§ï¼Œå¯ä»¥è·å–æ•´ä¸ªåŒ¹é…ç»“æœçš„å¼€å§‹ä½ç½®ã€‚ä½†æ˜¯ï¼Œç»„åŒ¹é…çš„æ¯ä¸ªç»„çš„å¼€å§‹ä½ç½®ï¼Œå¾ˆéš¾æ‹¿åˆ°ã€‚

[ES2022](https://github.com/tc39/proposal-regexp-match-Indices) æ–°å¢äº†`d`ä¿®é¥°ç¬¦ï¼Œè¿™ä¸ªä¿®é¥°ç¬¦å¯ä»¥è®©`exec()`ã€`match()`çš„è¿”å›ç»“æœæ·»åŠ `indices`å±æ€§ï¼Œåœ¨è¯¥å±æ€§ä¸Šé¢å¯ä»¥æ‹¿åˆ°åŒ¹é…çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚

```
const text = 'zabbcdef';
const re = /ab/d;
const result = re.exec(text);

result.index // 1
result.indices // [ [1, 3] ]
```

ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œ`exec()`æ–¹æ³•çš„è¿”å›ç»“æœ`result`ï¼Œå®ƒçš„`index`å±æ€§æ˜¯æ•´ä¸ªåŒ¹é…ç»“æœï¼ˆ`ab`ï¼‰çš„å¼€å§‹ä½ç½®ã€‚ç”±äºæ­£åˆ™è¡¨è¾¾å¼`re`æœ‰`d`ä¿®é¥°ç¬¦ï¼Œ`result`ç°åœ¨å°±ä¼šå¤šå‡ºä¸€ä¸ª`indices`å±æ€§ã€‚è¯¥å±æ€§æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„æ¯ä¸ªæˆå‘˜è¿˜æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº†åŒ¹é…ç»“æœåœ¨åŸå§‹å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚ç”±äºä¸Šä¾‹çš„æ­£åˆ™è¡¨è¾¾å¼`re`æ²¡æœ‰åŒ…å«ç»„åŒ¹é…ï¼Œæ‰€ä»¥`indices`æ•°ç»„åªæœ‰ä¸€ä¸ªæˆå‘˜ï¼Œè¡¨ç¤ºæ•´ä¸ªåŒ¹é…çš„å¼€å§‹ä½ç½®æ˜¯`1`ï¼Œç»“æŸä½ç½®æ˜¯`3`ã€‚

æ³¨æ„ï¼Œå¼€å§‹ä½ç½®åŒ…å«åœ¨åŒ¹é…ç»“æœä¹‹ä¸­ï¼Œç›¸å½“äºåŒ¹é…ç»“æœçš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ä½ç½®ã€‚ä½†æ˜¯ï¼Œç»“æŸä½ç½®ä¸åŒ…å«åœ¨åŒ¹é…ç»“æœä¹‹ä¸­ï¼Œæ˜¯åŒ¹é…ç»“æœçš„ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚æ¯”å¦‚ï¼Œä¸Šä¾‹åŒ¹é…ç»“æœçš„æœ€åä¸€ä¸ªå­—ç¬¦`b`çš„ä½ç½®ï¼Œæ˜¯åŸå§‹å­—ç¬¦ä¸²çš„ 2 å·ä½ï¼Œé‚£ä¹ˆç»“æŸä½ç½®`3`å°±æ˜¯ä¸‹ä¸€ä¸ªå­—ç¬¦çš„ä½ç½®ã€‚

å¦‚æœæ­£åˆ™è¡¨è¾¾å¼åŒ…å«ç»„åŒ¹é…ï¼Œé‚£ä¹ˆ`indices`å±æ€§å¯¹åº”çš„æ•°ç»„å°±ä¼šåŒ…å«å¤šä¸ªæˆå‘˜ï¼Œæä¾›æ¯ä¸ªç»„åŒ¹é…çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚

```
const text = 'zabbcdef';
const re = /ab+(cd)/d;
const result = re.exec(text);

result.indices // [ [ 1, 6 ], [ 4, 6 ] ]
```

ä¸Šé¢ä¾‹å­ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼`re`åŒ…å«ä¸€ä¸ªç»„åŒ¹é…`(cd)`ï¼Œé‚£ä¹ˆ`indices`å±æ€§æ•°ç»„å°±æœ‰ä¸¤ä¸ªæˆå‘˜ï¼Œç¬¬ä¸€ä¸ªæˆå‘˜æ˜¯æ•´ä¸ªåŒ¹é…ç»“æœï¼ˆ`abbcd`ï¼‰çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ï¼Œç¬¬äºŒä¸ªæˆå‘˜æ˜¯ç»„åŒ¹é…ï¼ˆ`cd`ï¼‰çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚

ä¸‹é¢æ˜¯å¤šä¸ªç»„åŒ¹é…çš„ä¾‹å­ã€‚

```
const text = 'zabbcdef';
const re = /ab+(cd(ef))/d;
const result = re.exec(text);

result.indices // [ [1, 8], [4, 8], [6, 8] ]
```

ä¸Šé¢ä¾‹å­ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼`re`åŒ…å«ä¸¤ä¸ªç»„åŒ¹é…ï¼Œæ‰€ä»¥`indices`å±æ€§æ•°ç»„å°±æœ‰ä¸‰ä¸ªæˆå‘˜ã€‚

å¦‚æœæ­£åˆ™è¡¨è¾¾å¼åŒ…å«å…·åç»„åŒ¹é…ï¼Œ`indices`å±æ€§æ•°ç»„è¿˜ä¼šæœ‰ä¸€ä¸ª`groups`å±æ€§ã€‚è¯¥å±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥ä»è¯¥å¯¹è±¡è·å–å…·åç»„åŒ¹é…çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚

```
const text = 'zabbcdef';
const re = /ab+(?<Z>cd)/d;
const result = re.exec(text);

result.indices.groups // { Z: [ 4, 6 ] }
```

ä¸Šé¢ä¾‹å­ä¸­ï¼Œ`exec()`æ–¹æ³•è¿”å›ç»“æœçš„`indices.groups`å±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæä¾›å…·åç»„åŒ¹é…`Z`çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚

å¦‚æœè·å–ç»„åŒ¹é…ä¸æˆåŠŸï¼Œ`indices`å±æ€§æ•°ç»„çš„å¯¹åº”æˆå‘˜åˆ™ä¸º`undefined`ï¼Œ`indices.groups`å±æ€§å¯¹è±¡çš„å¯¹åº”æˆå‘˜ä¹Ÿæ˜¯`undefined`ã€‚

```
const text = 'zabbcdef';
const re = /ab+(?<Z>ce)?/d;
const result = re.exec(text);

result.indices[1] // undefined
result.indices.groups['Z'] // undefined
```

ä¸Šé¢ä¾‹å­ä¸­ï¼Œç”±äºç»„åŒ¹é…`ce`ä¸æˆåŠŸï¼Œæ‰€ä»¥`indices`å±æ€§æ•°ç»„å’Œ`indices.groups`å±æ€§å¯¹è±¡å¯¹åº”çš„ç»„åŒ¹é…æˆå‘˜`Z`éƒ½æ˜¯`undefined`ã€‚

## String.prototype.matchAll()

å¦‚æœä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åœ¨å­—ç¬¦ä¸²é‡Œé¢æœ‰å¤šä¸ªåŒ¹é…ï¼Œç°åœ¨ä¸€èˆ¬ä½¿ç”¨`g`ä¿®é¥°ç¬¦æˆ–`y`ä¿®é¥°ç¬¦ï¼Œåœ¨å¾ªç¯é‡Œé¢é€ä¸€å–å‡ºã€‚

```
var regex = /t(e)(st(\d?))/g;
var string = 'test1test2test3';

var matches = [];
var match;
while (match = regex.exec(string)) {
  matches.push(match);
}

matches
// [
//   ["test1", "e", "st1", "1", index: 0, input: "test1test2test3"],
//   ["test2", "e", "st2", "2", index: 5, input: "test1test2test3"],
//   ["test3", "e", "st3", "3", index: 10, input: "test1test2test3"]
// ]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`while`å¾ªç¯å–å‡ºæ¯ä¸€è½®çš„æ­£åˆ™åŒ¹é…ï¼Œä¸€å…±ä¸‰è½®ã€‚

[ES2020](https://github.com/tc39/proposal-string-matchall) å¢åŠ äº†`String.prototype.matchAll()`æ–¹æ³•ï¼Œå¯ä»¥ä¸€æ¬¡æ€§å–å‡ºæ‰€æœ‰åŒ¹é…ã€‚ä¸è¿‡ï¼Œå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªéå†å™¨ï¼ˆIteratorï¼‰ï¼Œè€Œä¸æ˜¯æ•°ç»„ã€‚

```
const string = 'test1test2test3';
const regex = /t(e)(st(\d?))/g;

for (const match of string.matchAll(regex)) {
  console.log(match);
}
// ["test1", "e", "st1", "1", index: 0, input: "test1test2test3"]
// ["test2", "e", "st2", "2", index: 5, input: "test1test2test3"]
// ["test3", "e", "st3", "3", index: 10, input: "test1test2test3"]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œç”±äº`string.matchAll(regex)`è¿”å›çš„æ˜¯éå†å™¨ï¼Œæ‰€ä»¥å¯ä»¥ç”¨`for...of`å¾ªç¯å–å‡ºã€‚ç›¸å¯¹äºè¿”å›æ•°ç»„ï¼Œè¿”å›éå†å™¨çš„å¥½å¤„åœ¨äºï¼Œå¦‚æœåŒ¹é…ç»“æœæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°ç»„ï¼Œé‚£ä¹ˆéå†å™¨æ¯”è¾ƒèŠ‚çœèµ„æºã€‚

éå†å™¨è½¬ä¸ºæ•°ç»„æ˜¯éå¸¸ç®€å•çš„ï¼Œä½¿ç”¨`...`è¿ç®—ç¬¦å’Œ`Array.from()`æ–¹æ³•å°±å¯ä»¥äº†ã€‚

```
// è½¬ä¸ºæ•°ç»„çš„æ–¹æ³•ä¸€
[...string.matchAll(regex)]

// è½¬ä¸ºæ•°ç»„çš„æ–¹æ³•äºŒ
Array.from(string.matchAll(regex))
```

### ç•™è¨€
